# Commands

## Gestione del traffico

| comando                                                                                    | funzione                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | livello                                                                                                  | opzioni                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `tcpdump`                                                                                  | intercettare (e/o filtrare) il traffico che passa da un'interfaccia di rete. Stampa a video l'header dei pacchetti in transito su una LAN che corrispondono alle caratteristiche indicate in `expression`. Quando termina la sua esecuzione fornisce un report riguardante il numero di pacchetti ricevuti e il numero di pacchetti scartati dal kernel. Con le espressioni si definiscono i criteri qualitativi con i quali scegliere i pacchetti da visualizzare. Le `expression` consistono in una o più primitive precedute da "qualificatori":<br>**type** $\rightarrow$ host, net, port<br>**dir** $\rightarrow$ src, dest, src or dest<br>**proto** $\rightarrow$ ether, fddi, tr, ip, ip6, arp, rarp, decnet, tcp, udp |                                                                                                          | `-c count`: termina dopo aver ricevuto `count` pacchetti<br> `-C file_size`<br> `-e`: visualizza gli header a livello DATA LINK<br> `-F file`<br> `-i interface`: rimane in ascolto sull'interfaccia di rete indicata (`interface`)<br> `-m module`<br> `-n`: non converte gli indirizzi (IP, di porta...) in nomi (mantiene formato numerico)<br> `-r file`: legge i pacchetti dal file `file` <br> `-s snaplen`<br> `-T type`<br> `-w file`: scrive traffico raccolto su file<br> `-E algo:secret`: usa `algo:secret` per decifrare i pacchetti IPsec<br> `expression`: modi di filtrare/ripulire il traffico<br> `-X`: visualizza i pacchetti in formato hex e ascii |
| `arping <ip_addr>`                                                                         | verificare la connettività di rete inviando una successione di richieste ARP (in broadcast) per un determinato indirizzo IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | h2n (livello 2, permette di raggiungere solo gli host che fanno parte dello stesso dominio di broadcast) | `-0`: da usare se l'indirizzo IP dell'interfaccia non è configurato <br> `-i <iface>`: forza l'utilizzo di un'interfaccia di rete (senza l'opzione cerca di "indovinare" in base alla configurazione delle interfacce)<br> `-B`: esegue ARP cercando di risolvere l'indirizzo IP 255.255.255.255 (indirizzo di broadcast)                                                                                                                                                                                                                                                                                                                                               |
| `ping <name>`                                                                              | verificare la connettività di rete inviando una successione di pacchetti ICMP **ECHO_REQUEST** e attendere la relativa risposta **ECHO_REPLY**. Misura il tempo che intercorre tra l'invio e la ricezione di ogni pacchetto e riporta semplici statistiche. Il parametro `<name>` può essere sia un indirizzo IP che un nome simbolico                                                                                                                                                                                                                                                                                                                                                                                         | rete (livello 3)                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `ip neigh`                                                                                 | consultare la tabella ARP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `sysctl -w net.ipv4.conf.all.arp_announce=1`<br>`sysctl -w net.ipv4.conf.all.arp_ignore=2` | quando un host ha più di un'interfaccia collegata allo stesso dominio di broadcast ethernet, evita risposte duplicate consentendo solo all'interfaccia cercata di rispondere (nel caso in cui l'interfaccia che fa la richiesta e quella che deve rispondere abbiano lo **stesso netID**), impedisce la comunicazione fra le interfacce di rete se queste hanno **netID** diversi                                                                                                                                                                                                                                                                                                                                              |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

## Configurazione/deconfigurazione della rete

| comando                                                    | funzione                                                                                                         | opzioni                                                                                                                                                                      |
| ---------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ip addr show`                                             | mostrare tutte le interfacce di rete associate all'host che esegue il comando                                    | `dev <interface>`: mostra le informazioni relative alla scheda di rete `<interface>`                                                                                         |
| `ip addr {add, change, replace} dev <interface> <ip_addr>` | assegnare (`add`) all'interfaccia di rete `<interface>` l'indirizzo ip `<ip_addr>` **temporaneamente**           |                                                                                                                                                                              |
| `ip addr del <address> dev <interface>`                    | rimuovere l'assegnazione di un indirizzo                                                                         |                                                                                                                                                                              |
| `ip link set dev <interface> {up, down}`                   | attivare (`up`) o disattivare (`down`) la scheda di rete `<interface>` (**non legge il file di configurazione**) |                                                                                                                                                                              |
| `ifup <interface>`                                         | accendere la scheda di rete `<interface>` (**solo se esiste il file di configurazione**)                         | `-a`: se specificata al posto di `<interface>` permette di agire su tutte le interfacce *configurate* (aka che hanno la direttiva `auto` nel file `/etc/network/interfaces`) |
| `ifdown <interface>`                                       | spegnere la scheda di rete `<interface>` (**solo se esiste il file di configurazione**)                          |                                                                                                                                                                              |
| `hostname <name>`                                          | assegnare temporaneamente l'hostname `<name>` all'host che esegue il comando                                     |                                                                                                                                                                              |
| `service networking restart`                               | riavviare i servizi di rete                                                                                      |                                                                                                                                                                              |
### File di configurazione

| percorso                  | funzione                                                                                                                                                                                                                                          |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `/etc/hosts`              | contiene i nomi degli host associati ai rispettivi indirizzi IP, serve per assegnare in modo permanente l'hostname della macchina che si sta configurando, ogni conflitto viene risolto dando la precedenza alla **prima** corrispondenza trovata |
| `/etc/network/interfaces` | serve per configurare permanentemente le interfacce di rete del sistema                                                                                                                                                                           |
#### Esempio di configurazione dei file

```
# file di configurazione /etc/network/interfaces

auto <interface>
iface <interface> inet static
	address <ip_addr>
```

| elemento           | significato                                                                                                      |
| ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| `auto <interface>` | quando avvio la macchina voglio che la configurazione per l'interfaccia `interface` sia automaticamente caricata |
| `inet`             | voglio configurare l'interfaccia secondo lo standard IPv4                                                        |
| `iface <mode>`     | specifico la modalità (`mode`) con cui voglio configurare l'interfaccia                                          |

| modalità          | significato                                                                                                                                                                                                                                                                      |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `dhcp`            | inizializzazione dell'interfaccia in modo automatico col protocollo dhcp (non servono altri parametri)                                                                                                                                                                           |
| `loopback`        | interfaccia locale (127.0.0.1) per far comunicare processi sulla stessa macchina (passare per la scheda di rete ogni volta degrada le prestazioni), ha una MTU di 64K perché sulla stessa macchina non si possono avere conflitti (si ha quindi il massimo throughput possibile) |
| `static <params>` | voglio configurare l'interfaccia in modo statico (seguono i parametri `<params>`)                                                                                                                                                                                                |

| parametro           | significato                                                                                    |
| ------------------- | ---------------------------------------------------------------------------------------------- |
| `address <ip_addr>` | specifico che all'interfaccia verrà associato come indirizzo IP `<ip_addr>`                    |
| `netmask <nm>`      | specifico che la netmask da utilizzare sarà `<nm>`                                             |
| `network <na>`      | specifico l'indirizzo della rete (`<na>`)                                                      |
| `broadcast <ba>`    | specifico l'indirizzo di broadcast `<ba>`                                                      |
| `gateway <gw>`      | specifico il **default gateway**, da utilizzare nel caso la configurazione di rete lo richieda |
```
# file di configurazione /etc/hosts

127.0.0.1   localhost
192.168.1.1 h1
192.168.1.2 h2
```

