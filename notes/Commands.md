# Commands


## Miscellaneous

| comando                                                                             | funzione                                                             | opzioni                                                                                                                                  |
| ----------------------------------------------------------------------------------- | -------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| `tar`                                                                               | `tape archive`                                                       | `x`: scompatta il file (`extract`)<br>`z`: comprime il file usando `gzip` (`compress`)<br>`v`: `verbose`<br>`c`: crea il file (`create`) |
| `md5sum`                                                                            | calcola l'hash                                                       |                                                                                                                                          |
| `time <command>`                                                                    | misura il tempo di esecuzione di un comando (`command`)              |                                                                                                                                          |
| `dd if={/dev/zero, /dev/urandom} of=<filename>.<ext> bs=<block-size> count=<count>` | crea un file `<filename>.<ext>` di dimensione `<block-size>*<count>` |                                                                                                                                          |
| `make <exe>`                                                                        | crea l'eseguibile `<exe>` a partire da un file `<exe>.c`             |                                                                                                                                          |
| `chmod a+x <file>`                                                                  | rende il file `<file>` eseguibile                                    |                                                                                                                                          |

## Tool livello trasporto

| comando                           | funzione                                                                                                          | opzioni                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --------------------------------- | ----------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `nc`                              | `netcat`                                                                                                          | `-c "<command>"`: esegue un comando (`<command>`) all'apertura della connessione (anche in modalità server)<br>`-l`: server in attesa di richieste di connessione<br>`-p`: porta su cui il server si mette in ascolto<br>`-u`: utilizza protocollo UDP al posto di TCP<br>`-v`: verbose output<br>`-n`: non effettua risoluzioni o reverse lookup DNS (lavoro solo in modalità numerica)<br>`-U`: impiega una socket unix<br>`-s <ipaddress>`: forza l'indirizzo IP sorgente indicato (*solo client*, bisogna assicurarsi che ci sia coerenza con quello effettivo)<br>`-p <port>`: forza l'uso della porta indicata (*solo client*, se porta già in uso fallisce)<br>`-q <n>`: chiude la connessione dopo `<n>` dal momento in cui incontra un `EOF` (aka si interrompe `stdint`) |
| `nc [-options] <hostname> <port>` | client: aprire una connessione verso un server (`<hostname>` a cui mi voglio collegare, `<port>` numero di porta) |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `ss [-options] [query]`           | `socket statistics`                                                                                               | `-t`: mostra le connessioni TCP<br>`-u`: mostra le connessioni UDP<br>`-e`: mostra informazioni aggiuntive<br>`-l`: mostra le socket in stato `listen` (pronte ad accettare connessioni)<br>`-a`: mostra le socket in qualsiasi stato esse siano<br>`-n`: non effettua la risoluzione DNS degli indirizzi e delle porte "note"<br>`-p`: mostra il programma (PID ed eseguibile) associato alla connessione                                                                                                                                                                                                                                                                                                                                                                         |

## DHCP

| comando                    | funzione                         |
| -------------------------- | -------------------------------- |
| `systemctl enable dnsmasq` | avviare il server all'accensione |
| `service dnsmasq start`    | lanciare il server               |

## Traffic shaping

| comando                                                                                                                                            | funzione                                                                    | opzioni                                                                                                                                                                                                    |
| -------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `tc [-s] qdisc show dev <iface>`                                                                                                                   | visualizzare le regole qdisc dell'interfaccia                               | `-s`: mostra anche le statistiche                                                                                                                                                                          |
| `tc {qdisc, class} add dev <iface> root [handle <handle>] <qdisc-type> <qdisc-options>`                                                            | impostare la root qdisc (`qdisc`) o classe (`class`)                        | `default <minor>`: indica di usare come default la disciplina che ha come *minor number* `<minor>`<br>`limit <limit>`: permette di accodare massimo `<limit>` pacchetti (per es. nelle discipline `pfifo`) |
| `tc {qdisc, class} add dev <iface> parent <class-handle> [classid <class-id>] <qdisc-type> <qdisc-options>`                                        | aggiungere una qdisc (`qdisc`) o una classe (`class`) a un handle esistente |                                                                                                                                                                                                            |
| `tc filter add dev <iface> protocol <proto> parent <qdisc-handle> <filter-type> match <proto-rule> flowid <class-handle>`                          | aggiungere un filtro (es. `<filter-type> = u32`)                            |                                                                                                                                                                                                            |
| `tc filter show dev <iface>`                                                                                                                       | mostrare i filtri dell'interfaccia                                          |                                                                                                                                                                                                            |
| `tc qdisc del dev <iface> root`                                                                                                                    | eliminare la root qdisc                                                     |                                                                                                                                                                                                            |
| `tc qdisc del dev <iface> handle <handle>`                                                                                                         | eliminare la qdisc corrispondente ad un handle                              |                                                                                                                                                                                                            |
| `tc {qdisc, class} add dev <iface> {root, parent <handle>} [classid <class-id>] tbf rate <rate> [ceil <max-rate>] burst <burst> latency <latency>` | configurare una qdisc di tipo tbf                                           |                                                                                                                                                                                                            |



## Gestione del traffico

| comando                                                                                    | funzione                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | livello                                                                                                  | opzioni                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `tcpdump`                                                                                  | intercettare (e/o filtrare) il traffico che passa da un'interfaccia di rete. Stampa a video l'header dei pacchetti in transito su una LAN che corrispondono alle caratteristiche indicate in `expression`. Quando termina la sua esecuzione fornisce un report riguardante il numero di pacchetti ricevuti e il numero di pacchetti scartati dal kernel. Con le espressioni si definiscono i criteri qualitativi con i quali scegliere i pacchetti da visualizzare. Le `expression` consistono in una o più primitive precedute da "qualificatori":<br>**type** $\rightarrow$ host, net, port<br>**dir** $\rightarrow$ src, dest, src or dest<br>**proto** $\rightarrow$ ether, fddi, tr, ip, ip6, arp, rarp, decnet, tcp, udp |                                                                                                          | `-c count`: termina dopo aver ricevuto `count` pacchetti<br> `-C file_size`<br> `-e`: visualizza gli header a livello DATA LINK<br> `-F file`<br> `-i interface`: rimane in ascolto sull'interfaccia di rete indicata (`interface`)<br> `-m module`<br> `-n`: non converte gli indirizzi (IP, di porta...) in nomi (mantiene formato numerico)<br> `-r file`: legge i pacchetti dal file `file` <br> `-s snaplen`<br> `-T type`<br> `-w file`: scrive traffico raccolto su file<br> `-E algo:secret`: usa `algo:secret` per decifrare i pacchetti IPsec<br> `expression`: modi di filtrare/ripulire il traffico<br> `-X`: visualizza i pacchetti in formato hex e ascii |
| `arping <ip_addr>`                                                                         | verificare la connettività di rete inviando una successione di richieste ARP (in broadcast) per un determinato indirizzo IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | h2n (livello 2, permette di raggiungere solo gli host che fanno parte dello stesso dominio di broadcast) | `-0`: da usare se l'indirizzo IP dell'interfaccia non è configurato <br> `-i <iface>`: forza l'utilizzo di un'interfaccia di rete (senza l'opzione cerca di "indovinare" in base alla configurazione delle interfacce)<br> `-B`: esegue ARP cercando di risolvere l'indirizzo IP 255.255.255.255 (indirizzo di broadcast)                                                                                                                                                                                                                                                                                                                                               |
| `ping <name>`                                                                              | verificare la connettività di rete inviando una successione di pacchetti ICMP **ECHO_REQUEST** e attendere la relativa risposta **ECHO_REPLY**. Misura il tempo che intercorre tra l'invio e la ricezione di ogni pacchetto e riporta semplici statistiche. Il parametro `<name>` può essere sia un indirizzo IP che un nome simbolico                                                                                                                                                                                                                                                                                                                                                                                         | rete (livello 3)                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `ip neigh`                                                                                 | consultare la tabella ARP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `ip route show`                                                                            | consultare la tabella di routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `sysctl -w net.ipv4.conf.all.arp_announce=1`<br>`sysctl -w net.ipv4.conf.all.arp_ignore=2` | quando un host ha più di un'interfaccia collegata allo stesso dominio di broadcast ethernet, evita risposte duplicate consentendo solo all'interfaccia cercata di rispondere (nel caso in cui l'interfaccia che fa la richiesta e quella che deve rispondere abbiano lo **stesso netID**), impedisce la comunicazione fra le interfacce di rete se queste hanno **netID** diversi                                                                                                                                                                                                                                                                                                                                              |                                                                                                          | `-w`: write                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `sysctl -w net.ipv4.ip_forward=1`                                                          | abilitare un nodo a comportarsi come gateway **temporaneamente**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `sysctl -p <file>`                                                                         | leggere/processare il file `<file>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                          | `-p`: parse                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

## Configurazione/deconfigurazione della rete

| comando                                                    | funzione                                                                                                                                                                                                                                                      | opzioni                                                                                                                                                                      |
| ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ip addr show`                                             | mostrare tutte le interfacce di rete associate all'host che esegue il comando                                                                                                                                                                                 | `dev <interface>`: mostra le informazioni relative alla scheda di rete `<interface>`                                                                                         |
| `ip addr {add, change, replace} dev <interface> <ip_addr>` | assegnare (`add`) all'interfaccia di rete `<interface>` l'indirizzo ip `<ip_addr>` **temporaneamente**                                                                                                                                                        |                                                                                                                                                                              |
| `ip addr del <address> dev <interface>`                    | rimuovere l'assegnazione di un indirizzo                                                                                                                                                                                                                      |                                                                                                                                                                              |
| `ip link set dev <interface> {up, down}`                   | attivare (`up`) o disattivare (`down`) la scheda di rete `<interface>` (**non legge il file di configurazione**)                                                                                                                                              |                                                                                                                                                                              |
| `ifup <interface>`                                         | accendere la scheda di rete `<interface>` (**solo se esiste il file di configurazione**)                                                                                                                                                                      | `-a`: se specificata al posto di `<interface>` permette di agire su tutte le interfacce *configurate* (aka che hanno la direttiva `auto` nel file `/etc/network/interfaces`) |
| `ifdown <interface>`                                       | spegnere la scheda di rete `<interface>` (**solo se esiste il file di configurazione**)                                                                                                                                                                       |                                                                                                                                                                              |
| `hostname <name>`                                          | assegnare temporaneamente l'hostname `<name>` all'host che esegue il comando                                                                                                                                                                                  |                                                                                                                                                                              |
| `service networking restart`                               | riavviare i servizi di rete                                                                                                                                                                                                                                   |                                                                                                                                                                              |
| `ip link add link <physif> <virtif> type vlan id <N>`      | creare l'interfaccia VLAN, `<physif>` è il nome della scheda di rete fisica, `<virtif>` è il nome della scheda di rete virtuale (convenzione `nomeschedafisica.vlanID`), `<N>` è il VLAN ID (numero). L'interfaccia creata in questo modo sarà **temporanea** |                                                                                                                                                                              |
| `ip link del <virtif>`                                     | rimuovere l'interfaccia VLAN                                                                                                                                                                                                                                  |                                                                                                                                                                              |
| `ip route show`                                            | mostrare la tabella di routing                                                                                                                                                                                                                                |                                                                                                                                                                              |
| `ifconfig <interface> 0 down`                              | reinizializzare l'interfaccia `<interface>`                                                                                                                                                                                                                   |                                                                                                                                                                              |
| `ip route add default via <gwaddr>`                        | aggiungere **temporaneamente** alla tabella di routing il default gateway `<gwaddr>`                                                                                                                                                                          |                                                                                                                                                                              |
| `ip route add <net/cidr> via <gwaddr>`                     | aggiungere **temporaneamente** una riga alla tabella di routing specificando la sottorete `<net/cidr>` (**net è il Net ID, non va messo l'ip completo dell'host**)                                                                                            |                                                                                                                                                                              |
| `ip route add <ip/32> via <gwaddr>`                        | aggiungere **temporaneamente** una riga alla tabella di routing specificando l'host `<ip/32>`                                                                                                                                                                 |                                                                                                                                                                              |
| `ip route add <ip/32> dev <ethX>`                          | aggiungere **temporaneamente** una riga alla tabella di routing specificando l'host `<ip/32>` e l'interfaccia `ethX` (nel caso in cui il nodo non sia raggiungibile in altro modo ma è già attaccato alla rete)                                               |                                                                                                                                                                              |

### File di configurazione

| percorso                  | funzione                                                                                                                                                                                                                                          |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `/etc/hosts`              | contiene i nomi degli host associati ai rispettivi indirizzi IP, serve per assegnare in modo permanente l'hostname della macchina che si sta configurando, ogni conflitto viene risolto dando la precedenza alla **prima** corrispondenza trovata |
| `/etc/network/interfaces` | serve per configurare permanentemente le interfacce di rete del sistema                                                                                                                                                                           |
| `/etc/sysctl.conf`        |                                                                                                                                                                                                                                                   |
| `/etc/services`           | contiene le well-known ports                                                                                                                                                                                                                      |
| `/etc/dnsmasq.conf`       | serve per configurare il server DHCP                                                                                                                                                                                                              |
#### Esempio di configurazione dei file

##### Configurazione di una interfaccia Ethernet fisica

```
# file di configurazione /etc/network/interfaces

auto <interface>
iface <interface> inet static
	address <ip_addr>
	...
	post-up <command>
```

| elemento           | significato                                                                                                      |
| ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| `auto <interface>` | quando avvio la macchina voglio che la configurazione per l'interfaccia `interface` sia automaticamente caricata |
| `inet`             | voglio configurare l'interfaccia secondo lo standard IPv4                                                        |
| `iface <mode>`     | specifico la modalità (`mode`) con cui voglio configurare l'interfaccia                                          |

| modalità          | significato                                                                                                                                                                                                                                                                      |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `dhcp`            | inizializzazione dell'interfaccia in modo automatico col protocollo dhcp (non servono altri parametri)                                                                                                                                                                           |
| `loopback`        | interfaccia locale (127.0.0.1) per far comunicare processi sulla stessa macchina (passare per la scheda di rete ogni volta degrada le prestazioni), ha una MTU di 64K perché sulla stessa macchina non si possono avere conflitti (si ha quindi il massimo throughput possibile) |
| `static <params>` | voglio configurare l'interfaccia in modo statico (seguono i parametri `<params>`)                                                                                                                                                                                                |

| parametro                       | significato                                                                                                                                                                                                           |
| ------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `address <ip_addr>[/<netmask>]` | specifico che all'interfaccia verrà associato come indirizzo IP `<ip_addr>`, opzionalmente posso esplicitare la netmask sotto forma di numero di bit che la costituiscono (`netmask` è un numero che varia da 0 a 32) |
| `network <network>`             | specifico l'indirizzo della rete (`<network>`)                                                                                                                                                                        |
| `broadcast <broadcast>`         | specifico l'indirizzo di broadcast `<broadcast>`                                                                                                                                                                      |
| `gateway <ip_addr_gateway>`     | specifico il **default gateway**, da utilizzare nel caso la configurazione di rete lo richieda                                                                                                                        |
| `post-up <command>`             | specifico un comando (`<command>`) da eseguire ogni volta che la scheda è stata configurata                                                                                                                           |

##### Configurazione di una VLAN

```
# file di configurazione /etc/network/interfaces

auto <interface>.<N>
iface <interface>.<N> inet static
	address <ip_addr>/<netmask>
	gateway <ip_addr_gateway>
```

`<interface>` è la scheda di rete fisica, `<N>` è il VLAN ID della scheda di rete virtuale
##### Configurazione dei nomi degli hosts

```
# file di configurazione /etc/hosts

127.0.0.1   localhost
192.168.1.1 h1
192.168.1.2 h2
```

##### Configurazione server DHCP

```
# file di configurazione /etc/dnsmasq.conf

no-resolv
read-ethers
interface=eth0
domain=reti.org
dhcp-option=option:router,192.168.1.254
dhcp-option=option:dns-server,192.168.1.254
dhcp-range=192.168.1.10,192.168.1.20,1h
dhcp-host=02:04:06:11:22:33,client3,192.168.1.3,1h
address=/www.doubleclick.com/127.0.0.1
```

| elemento                                                 | significato                                                                                                                         |
| -------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `no-resolv`                                              | non mi interessa specificare altri nameservers/non cercare altri nameservers                                                        |
| `read-ethers`                                            | leggi il file `/etc/ethers`                                                                                                         |
| `interface=<iface>`                                      | interfaccia su cui è in ascolto/interfaccia di rete per DHCP                                                                        |
| `domain=<name>`                                          | specificare dominio implicito (aggiunto in coda se non scritto direttamente)                                                        |
| `dhcp-option`                                            | aggiungere parametri di configurazione nella risposta                                                                               |
| `dhcp-range=<min_IP>,<max_IP>,<lease_time>`              | range di indirizzi che posso assegnare dinamicamente + lease time                                                                   |
| `dhcp-host=<mac_addr>,<hostname>,<ip_addr>,<lease_time>` | indico la configurazione statica per i nodi che la richiedono (in alternativa si possono usare i file `/etc/ethers`ed `/etc/hosts`) |
| `address`                                                | sovrascrivo l'indirizzo (si può usare anche `/etc/hosts`)                                                                           |

## vde_switch

| comando                            | funzione                                                                                                                                          |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| `help [command]`                   | dare informazioni sul comando specificato (`command`), se non specificato nessun comando fornisce informazioni su tutti i comandi                 |
| `vlan/create <vlan_id>`            | creare la VLAN con ID `<vlan_id>` (numero) sullo switch                                                                                           |
| `port/setvlan <port_id> <vlan_id>` | impostare la VLAN con ID `<vlan_id>` (numero) in modalità **port-based** (*untagged*, quindi con un *access-link*) sulla porta numero `<port_id>` |
| `vlan/addport <vlan_id> <port_id>` | impostare la VLAN con ID `<vlan_id>` (numero) in modalità **tagged-based** (quindi con un *trunk-link*) sulla porta numero `<port_id>`            |
| `vlan/print`                       | mostrare informazioni sulle VLAN, ad esempio se il link è di tipo *trunk* (`tagged=1`) o *access* (`tagged=0`)                                    |
| `hash/print`                       | mostrare il MAC address associato a ogni porta                                                                                                    |
